datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

generator client {
    provider = "prisma-client-js"
}

model Usuario {
    id    Int         @id @default(autoincrement())
    nome  String
    login String      @unique
    senha String
    tipo  UsuarioTipo

    aluno     Aluno?
    professor Professor?
    empresa   Empresa?
}

model Aluno {
    id            Int    @id @default(autoincrement())
    email         String @unique
    cpf           String @unique
    rg            String @unique
    endereco      String
    saldo         Int
    instituicaoId Int
    usuarioId     Int    @unique

    usuario     Usuario     @relation(fields: [usuarioId], references: [id])
    instituicao Instituicao @relation(fields: [instituicaoId], references: [id])

    transacoes Transacao[]
}

model Transacao {
    id          Int            @id @default(autoincrement())
    numMoedas   Int
    tipo        TipoTransaocao
    data        DateTime
    cupom       String
    alunoId     Int
    empresaId   Int?
    professorId Int?

    aluno     Aluno      @relation(fields: [alunoId], references: [id])
    empresa   Empresa?   @relation(fields: [empresaId], references: [id])
    professor Professor? @relation(fields: [professorId], references: [id])
}

model Professor {
    id            Int    @id @default(autoincrement())
    cpf           String
    saldo         Int
    instituicaoId Int
    usuarioId     Int    @unique

    usuario     Usuario     @relation(fields: [usuarioId], references: [id])
    instituicao Instituicao @relation(fields: [instituicaoId], references: [id])

    transacoes Transacao[]
}

model Empresa {
    id        Int    @id @default(autoincrement())
    login     String
    senha     String
    usuarioId Int    @unique

    usuario Usuario @relation(fields: [usuarioId], references: [id])

    vantagens  Vantagem[]
    transacoes Transacao[]
}

model Vantagem {
    id        Int    @id @default(autoincrement())
    descricao String
    foto      String
    preco     Int

    empresaId Int

    empresa Empresa @relation(fields: [empresaId], references: [id])
}

model Instituicao {
    id       Int    @id @default(autoincrement())
    nome     String
    endereco String

    alunos      Aluno[]
    professores Professor[]
}

enum TipoTransaocao {
    TROCA
    ENVIO
    RECEBIMENTO
}

enum UsuarioTipo {
    ALUNO
    PROFESSOR
    EMPRESA
}
